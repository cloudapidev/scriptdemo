<?phprequire_once 'venders/limonade.php';require_once 'cloudapi/cloudapi.class.php';function getsession_tag() {  $json = file_get_contents("php://input");  if(empty($json)) {    return "";  }  $session = json_decode($json);  if (!is_object($session) || !property_exists($session, "session")) {    return "";  }  if (!is_object($session->session) || !property_exists($session->session, "tag")) {    return "";  }  return $session->session->tag;}$cloudapi = new Cloudapi();dispatch_post('/', 'entry');function entry(){	global $cloudapi;	global $apptoken;	global $apiroot;	try {		$cloudapiResult = new Result();  		select();	} catch (Exception $e) {		$cloudapiSession = new Session();		$cloudapi->cloudlog("qqgetsession_tag" . getsession_tag());        $To = $cloudapiSession->getTo();		$cloudapi->cloudlog("qqgetFrom" . $To['id']);		menu();	} }function menu(){    global $cloudapi;	$cloudapi->cloudlog("this is cloudlog test");    $params = array('name'=>'service','voice'=>'en','timeout'=>30.0,'attempts'=>3,'mode'=>'dtmf','interdigitTimeout'=>5,'terminator'=>'#','choices'=>'[1-6 DIGITS]');    $cloudapi->ask("Please choose the number to test function:joining conference ,press one;transfering ,press two,sending message ,press three;recording ,press four;hanging up ,press five;calling out and playing a advertisement,press six;playing a audio,press seven",$params);    $cloudapi->on(array('event'=>'continue','next'=>''));	$cloudapi->on(array('event'=>'hangup','next'=>''));	$cloudapi->renderJSON(); }function select(){	global $cloudapi;	global $apptoken;	global $apiroot;	$cloudapiResult = new Result();	$actions = $cloudapiResult->getActions();	$replyInput = "*";	if (!isset($actions)){		menu();	} else {		foreach ($actions as $action){			if($action->name === "service") {				menu_main($action->value);			}elseif($action->name === "sms") {				$cloudapi->say("you sms have send",array('name'=>'smssay'));				$cloudapi->hangup();				$cloudapi->on(array('event'=>'continue','next'=>''));				$cloudapi->on(array('event'=>'hangup','next'=>''));				$cloudapi->renderJSON();			}elseif($action->name === "askconfnumber") {				$cloudapi->say("The number which you will enter the conference meeting is:" . $action->value,array('voice'=>'en'));				$cloudapi->conference($action->value,array('name'=>'conference'));				$cloudapi->on(array('event'=>'continue','next'=>'/conferenceResult'));				$cloudapi->on(array('event'=>'hangup','next'=>''));				$cloudapi->renderJSON();			}elseif($action->name === "asktransfernumber") {				$cloudapi->say("You will be transferred to:" . $action->value, array('voice'=>'en'));				$cloudapi->transfer("tel:" . $action->value,array('name'=>'dotransfer', 'timeout'=>40.0));				$cloudapi->on(array('event'=>'continue','next'=>''));				$cloudapi->on(array('event'=>'hangup','next'=>''));				$cloudapi->renderJSON();			}elseif($action->name === "dotransfer") {				$cloudapi->say("Calling forwarding ends, return to the main menu",array('voice'=>'en'));				menu();			}elseif($action->name === "askcallnumber") {				$cloudapi->say("The outgoing and advertising to number:" . $action->value,array('voice'=>'en'));				$cloudapi->call($action->value,array('from'=>"6531520072",'name'=>'docall','timeout'=>40.0,'say'=>"This is a chapter from tela Chinese advertisement",'voice'=>'en'));				$cloudapi->on(array('event'=>'continue','next'=>''));				$cloudapi->on(array('event'=>'hangup','next'=>''));                $cloudapi->renderJSON();			}elseif($action->name === "docall") {				$cloudapi->say("Advertising ends and return to the main menu",array('voice'=>'en'));				menu();			}elseif($action->name === "asksmsnumber") {				$cloudapi->say("sending message to ：" . $action->value, array('voice'=>'en'));				$cloudapi->message("Tela try send sms to you with chiness",array('name'=>'sms','to'=>$action->value,'from'=>'6582400883'));				$cloudapi->on(array('event'=>'continue','next'=>''));				$cloudapi->on(array('event'=>'hangup','next'=>''));				$cloudapi->renderJSON();			}elseif($action->name === "dorecord") {				$cloudapi->say("Recording ends,you can play the audio on the cloud Homepage audio files, now return to the main menu:" . $action->value, array('voice'=>'en'));				menu();			}else {				//menu();			}		}	}}function menu_main($replyInput) {	global $cloudapi;		if ("#"===$replyInput){		}elseif ("1"===$replyInput){			$cloudapi->ask("Please enter the three-digit room number.",array('name'=>'askconfnumber','voice'=>'en','choices'=>'[3 DIGITS]'));			$cloudapi->on(array('event'=>'continue','next'=>''));			$cloudapi->on(array('event'=>'hangup','next'=>''));			$cloudapi->renderJSON();		}elseif ("2"===$replyInput){			$cloudapi->ask("Please enter the call forwarding number with country code",array('name'=>'asktransfernumber','voice'=>'en','choices'=>'[8-13 DIGITS]','timeout'=>30.0));			$cloudapi->on(array('event'=>'continue','next'=>''));			$cloudapi->on(array('event'=>'hangup','next'=>''));			$cloudapi->renderJSON();		}elseif ("3"===$replyInput){			$cloudapi->ask("Please enter the phone number which receives the message  with country code",array('name'=>'asksmsnumber','voice'=>'en','choices'=>'[8-13 DIGITS]','timeout'=>30.0));			$cloudapi->on(array('event'=>'continue','next'=>''));			$cloudapi->on(array('event'=>'hangup','next'=>''));			$cloudapi->renderJSON();		}elseif ("4"===$replyInput){			$cloudapi->say("starting recording,please hangup to exit", array('voice'=>'en'));			$cloudapi->record(array('beep'=>'true'));			$cloudapi->on(array('event'=>'continue','next'=>''));			$cloudapi->on(array('event'=>'hangup','next'=>''));			$cloudapi->renderJSON();		}elseif ("5"===$replyInput){			$cloudapi->say("some phones will be hung up", array('voice'=>'en'));			$cloudapi->hangup();			$cloudapi->on(array('event'=>'continue','next'=>''));			$cloudapi->on(array('event'=>'hangup','next'=>''));			$cloudapi->renderJSON();		}elseif ("6"===$replyInput){			$cloudapi->ask("Please enter the target phone  number with country code",array('name'=>'askcallnumber','voice'=>'en','choices'=>'[8-13 DIGITS]','timeout'=>30.0));			$cloudapi->on(array('event'=>'continue','next'=>''));			$cloudapi->on(array('event'=>'hangup','next'=>''));			$cloudapi->renderJSON();		}elseif ("7"===$replyInput){			$cloudapi->say("playing a audio after five seconds silence,and hanging up", array('voice'=>'en'));			$cloudapi->wait(array('milliseconds'=>5000));			$cloudapi->say("End of silence and  hang up", array('voice'=>'en'));			$cloudapi->renderJSON();        }}run();?>